# DaXBench-DMP
We employ DaXBench as a cloth simulator to analyze Deformable Object Manipulation (DOM), and the Dynamic Movement Primitives (DMP) method is applied to generate a series of parameterized trajectories by imitation learning.  The trajectories then are used in DaXBench cloth simulation environment to do folding manipulation.

[1]: https://github.com/straizys/cartesian-dmp                                           "cartesian-dmp"
[2]: https://github.com/Juyi9640/DaXBench-DMP/tree/main/cartesian-dmp                    "modified cartesian-dmp"
[3]: https://docs.anaconda.com/miniconda/                                                "Miniconda"
[4]: https://github.com/Juyi9640/DaXBench-DMP/blob/main/DaXBench-DMP/mb_mf.yml           "mb_mf.yml"
[5]: https://github.com/AdaCompNUS/DaXBench                                              "DaXBench"
[6]: https://github.com/Juyi9640/DaXBench-DMP/tree/main/DaXBench-DMP/cartesian_dmp       "cartesian_dmp"                             
[7]: https://github.com/Juyi9640/DaXBench-DMP/blob/main/DaXBench-DMP/fold_cloth1_env.py  "fold_cloth1_env.py"
[8]: https://github.com/Juyi9640/DaXBench-DMP/blob/main/DaXBench-DMP/cloth_env.py        "cloth_env.py"
[9]: https://github.com/Juyi9640/DaXBench-DMP/blob/main/DaXBench-DMP/py_render.py        "py_render.py"
[10]: https://github.com/Juyi9640/DaXBench-DMP/blob/main/DaXBench-DMP/util.py             "util.py"








### Major dependencies

- [DaXBench](https://github.com/AdaCompNUS/DaXBench)
- [cartesian-dmp](https://github.com/straizys/cartesian-dmp)



## Part A: cartesian-dmp
In this [modified cartesian-dmp][2], the DMP algorithms originalliy from [cartesian-dmp][1] is chosen and adapted to do imitation learning. We selected 6 different trajectories as demonstrations, which were used in DMP. These 6 trajectories include: helix, sine wave, spiral, parabola, the trajectory of dot_31 during the folding process in DaXBench, and a random curve containing sinusoidal perturbations along the y-direction, with Gaussian noise added to its x,y and z values.
<p align="center">
  <img src="pictures/1.png" width="800" title="hover text">
</p>
<p align="center">
  <img src="pictures/2.png" width="800" title="hover text">
</p>
<p align="center">
  <img src="pictures/3.png" width="800" title="hover text">
</p>
<p align="center">
  <img src="pictures/4.png" width="800" title="hover text">
</p>
<p align="center">
  <img src="pictures/5.png" width="800" title="hover text">
</p>
<p align="center">
  <img src="pictures/6.png" width="800" title="hover text">
</p>
We utilized Fr√©chet distance and Hausdorff distance as metrics to quantify the difference between the demonstration and its imitation generated by DMP algorithm, and the results are presented in this table:
<p align="center">
  <img src="pictures/metrics.png" width="600" title="hover text">
</p>

## Part B: DaXBench DMP Integration
As mentioned, we need a custom trajectory that can be parameterized to control the cloth
gripper point for cloth manipulation. 
First, the user clicks any start point and goal point on cloth,
the program then generates a curve which connects the start point and goal
point. This trajectory is then fed into the DMP algorithm, producing a new imitated trajectory.
The DMP trajectory is sent to DaXBench, ultimately enabling the control of the cloth
gripper point according to the DMP trajectory for cloth manipulation. Here is a demonstration:
<p align="center">
  <img src="gif/dmp traj.gif" width="800" title="hover text">
</p>


### Original DaXBench Installation 
Set up DaXBench environment using [Miniconda][3]:
```bash
mkdir -p ~/miniconda3
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh
bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3
rm ~/miniconda3/miniconda.sh
```
Open conda base environment:
```bash
conda activate
```
Download [mb_mf.yml][4] to a directory, navigate to this directory, and create the conda environment using the 'mb_mf.yml' file:
```bash
conda env create -f mb_mf.yml
```
Activate the newly created conda environment:
```bash
conda activate new_mb
```
Clone the DaXBench repository to a specific folder and install the DaXBench package:
```bash
git clone https://github.com/AdaCompNUS/DaXBench.git
cd DaXBench
pip install .
```
You can now run 'fold_cloth1_env.py' to test if it's correctly installed. <br />
(Tipps: Be prepared to some errors, for example you have to install the version of JAX without GPU-enabled, and try to modify the 'py_render.py' such that the program runs (Or use [py_render.py][9] here). Also if it complains about not finding/missing some files, just go to [DaXBench][5] repo and find the files and copy paste into your package at corresponding places.)

### Integrate DMP to DaXBench
1. copy the folder [cartesian_dmp][6] and paste it to: /home/user/miniconda3/envs/new_mb/lib/python3.9/site-packages/daxbench/core
2. copy [fold_cloth1_env.py][7] and replace it to : /home/user/miniconda3/envs/new_mb/lib/python3.9/site-packages/daxbench/core/envs
3. copy [cloth_env.py][8] and replace it to: /home/user/miniconda3/envs/new_mb/lib/python3.9/site-packages/daxbench/core/envs/basic
4. copy [py_render.py][9] and replace it to: /home/user/miniconda3/envs/new_mb/lib/python3.9/site-packages/daxbench/core/engine/pyrender
5. copy [util.py][10] and replace it to: /home/user/miniconda3/envs/new_mb/lib/python3.9/site-packages/daxbench/core/utils

That's all, now you can run DaXBench to test the cloth folding procedure with DMP trajectory by running 'fold_cloth1_env.py'. 


























